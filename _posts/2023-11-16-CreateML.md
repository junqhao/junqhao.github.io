---
layout:     post
title:      "é€šè¿‡CreateMLæ‰“é€ ä¸“å±äºè‡ªå·±Appçš„AIæ¨¡å‹"
subtitle:   ""
date:       2023-11-16 12:00:00
author:     "Self"
header-style: text
catalog: true
tags:
    - iOS
    - Swift
    - ML
---

[k30dq6fr99.png]:/img/post/20231116/k30dq6fr99.png
[create-ml-1.png]:/img/post/20231116/create-ml-1.png
[create-ml-2.png]:/img/post/20231116/create-ml-2.png
[k30dq6fr99.png]:/img/post/20231116/k30dq6fr99.png
[Untitled.png]:/img/post/20231116/Untitled.png
[Untitled.jpeg]:/img/post/20231116/Untitled.jpeg
[Untitled1.png]:/img/post/20231116/Untitled1.png
[Untitled1.jpeg]:/img/post/20231116/Untitled1.jpeg
[Untitled2]:/img/post/20231116/Untitled2.png
[Untitled3]:/img/post/20231116/Untitled3.png
[Untitled4]:/img/post/20231116/Untitled4.png
[Untitled5]:/img/post/20231116/Untitled5.png
[Untitled6]:/img/post/20231116/Untitled6.png
[Untitled7]:/img/post/20231116/Untitled7.png
[Untitled8]:/img/post/20231116/Untitled8.png
[Untitled9]:/img/post/20231116/Untitled9.png
[Untitled10]:/img/post/20231116/Untitled10.png
[Untitled11]:/img/post/20231116/Untitled11.png
[Untitled12]:/img/post/20231116/Untitled12.png
[Untitled13]:/img/post/20231116/Untitled13.png
[Untitled14]:/img/post/20231116/Untitled14.png
[Untitled15]:/img/post/20231116/Untitled15.png
[Untitled16]:/img/post/20231116/Untitled16.png
[Untitled17]:/img/post/20231116/Untitled17.jpg
[Untitled18]:/img/post/20231116/Untitled18.jpg
[Untitled19]:/img/post/20231116/Untitled19.jpg
[Untitled20]:/img/post/20231116/Untitled20.jpg

Appleåœ¨2017å¹´å‘å¸ƒäº†2ä¸ªæœºå™¨å­¦ä¹ æ¡†æ¶ï¼ŒCore MLå’ŒVisionï¼Œé€šè¿‡Core MLåªéœ€å‡ è¡Œä»£ç å³å¯å°†å¼ºå¤§çš„æ™ºèƒ½æœºå™¨å­¦ä¹ èƒ½åŠ›é›†æˆåˆ°å¼€å‘è€…çš„åº”ç”¨ç¨‹åºä¸­ï¼ŒVisionæ˜¯ä¸€ä¸ªè®¡ç®—æœºè§†è§‰ä»»åŠ¡æ¡†æ¶ï¼Œä¸“æ³¨äºå¤„ç†åŒ…æ‹¬å›¾åƒå’Œè§†é¢‘å¤„ç†ã€äººè„¸è¯†åˆ«ã€æ–‡æœ¬è¯†åˆ«å’Œå¯¹è±¡è¿½è¸ªç­‰é—®é¢˜ï¼ŒCore MLæä¾›äº†ååº•å±‚çš„æœºå™¨å­¦ä¹ èƒ½åŠ›ï¼Œå°±åƒæ˜¯Core Graphicsï¼Œè€ŒVisionä½¿ç”¨èµ·æ¥æ›´åƒæ˜¯UIKitçš„æ„Ÿè§‰ï¼Œæä¾›äº†æ›´åŠ ç®€å•çš„ä¸Šå±‚APIä¾›å¼€å‘è€…è°ƒç”¨ã€‚

![k30dq6fr99.png]

åœ¨Core MLé—®ä¸–ä¸€å¹´åï¼ŒAppleæ¨å‡ºäº†è‡ªå·±çš„æœºå™¨å­¦ä¹ å¯è§†åŒ–è®­ç»ƒå·¥å…·ï¼šCreate MLã€‚Create MLååˆ†å¼ºå¤§ï¼Œå®ƒä½¿å¼€å‘è€…èƒ½å¤Ÿä»¥æ— éœ€è¿‡å¤šçš„æœºå™¨å­¦ä¹ çŸ¥è¯†ä¸ºå‰æï¼Œå¿«é€Ÿè½»æ¾åœ°åˆ›å»ºç”¨äºå„ç§ä»»åŠ¡çš„æœºå™¨å­¦ä¹ æ¨¡å‹ï¼Œè¿™äº›æ¨¡å‹é€šè¿‡Core MLå¯ä»¥ç›´æ¥é›†æˆåˆ°iOSæˆ–macOSåº”ç”¨ä¸­ã€‚Create MLé‡‡ç”¨UIäº¤äº’æ–¹å¼æ¥è®­ç»ƒä¸€ä¸ªæ¨¡å‹ï¼Œå‡ ä¹0ä»£ç æˆæœ¬ï¼Œä¸æ‡‚å¼€å‘çš„äººä¹Ÿå¯ä»¥æ“ä½œï¼Œè®­ç»ƒå®Œæˆä¼šç»™å‡ºéå¸¸è¯¦ç»†çš„è®­ç»ƒç»“æœï¼Œä¸€é”®å¯¼å‡ºæ‹–åˆ°è‡ªå·±çš„Xcodeé¡¹ç›®å†…å°±å¯ä»¥å¼€å§‹ä½¿ç”¨äº†ï¼Œå½“ç„¶åœ¨Appå†…çš„ä½¿ç”¨è¿˜æ˜¯è¦æœ‰ä¸€å®šä»£ç åŸºç¡€çš„ã€‚

![create-ml-1.png]

è¿˜æœ‰å¾ˆå¤šæ–¹å¼å¯ä»¥å°†è®­ç»ƒå¥½çš„æ¨¡å‹æ„å»ºä¸ºCoreMLæ¨¡å‹ï¼Œæ¯”å¦‚Turi Createï¼ŒSwift for Tensorflowç­‰ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†å±•å¼€äº†ã€‚

![Untitled.png]

ä¸€èˆ¬æ¥è¯´ï¼Œåˆ›å»ºä¸€ä¸ªæœºå™¨å­¦ä¹ ï¼ˆMLï¼‰çš„å·¥ä½œæµç¨‹å¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªä¸»è¦æ­¥éª¤ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ”¶é›†å’Œå¤„ç†æ•°æ®ï¼Œå› ä¸ºè¿™æ˜¯æœºå™¨å­¦ä¹ æ¨¡å‹çš„åŸºç¡€ã€‚å…¶æ¬¡ï¼Œæˆ‘ä»¬éœ€è¦é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„æ¨¡å‹ï¼Œå¹¶å¯¹å…¶è¿›è¡Œè®­ç»ƒã€‚æœ€åï¼Œæˆ‘ä»¬éœ€è¦è¯„ä¼°æ¨¡å‹çš„æ€§èƒ½ï¼Œå¹¶æ ¹æ®éœ€è¦è¿›è¡Œä¼˜åŒ–ã€‚è¿™äº›æ­¥éª¤éƒ½æ˜¯åˆ›å»ºä¸€ä¸ªæˆåŠŸçš„æœºå™¨å­¦ä¹ å·¥ä½œæµç¨‹æ‰€å¿…éœ€çš„ã€‚

![create-ml-2.png]

# æ•°æ®é›†ï¼ˆData Setï¼‰

åœ¨æœºå™¨å­¦ä¹ æˆ–æ·±åº¦å­¦ä¹ çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦ä¸‰ç§ä¸åŒçš„æ•°æ®é›†æ¥è¿›è¡Œæ¨¡å‹çš„è®­ç»ƒå’Œè¯„ä¼°ï¼Œè¿™ä¸‰ç§æ•°æ®é›†åˆ†åˆ«æ˜¯è®­ç»ƒé›†ï¼ŒéªŒè¯é›†å’Œæµ‹è¯•é›†ã€‚

- è®­ç»ƒé›†æ˜¯ç”¨æ¥è®­ç»ƒæœºå™¨å­¦ä¹ æ¨¡å‹çš„æ•°æ®é›†ã€‚åœ¨è®­ç»ƒé›†ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“æ¯ä¸ªå®ä¾‹çš„è¾“å…¥å’Œé¢„æœŸè¾“å‡ºï¼Œç„¶åæˆ‘ä»¬å°†è¿™äº›æ•°æ®è¾“å…¥åˆ°æ¨¡å‹ä¸­ï¼Œè®©æ¨¡å‹é€šè¿‡å­¦ä¹ è¿™äº›è¾“å…¥å’Œè¾“å‡ºçš„å¯¹åº”å…³ç³»æ¥è¿›è¡Œå­¦ä¹ ã€‚è®­ç»ƒé›†çš„æ•°æ®é‡é€šå¸¸å æ€»æ•°æ®é‡çš„å¤§éƒ¨åˆ†ï¼Œå› ä¸ºæ¨¡å‹çš„å­¦ä¹ èƒ½åŠ›ä¸»è¦æ¥è‡ªäºè®­ç»ƒé›†çš„æ•°æ®ã€‚
- éªŒè¯é›†æ˜¯åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ç”¨æ¥è°ƒæ•´æ¨¡å‹å‚æ•°å’Œé˜²æ­¢è¿‡æ‹Ÿåˆçš„æ•°æ®é›†ã€‚åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä¸€éƒ¨åˆ†æ•°æ®æ¥éªŒè¯æ¨¡å‹åœ¨æœªè§è¿‡çš„æ•°æ®ä¸Šçš„è¡¨ç°ï¼Œä»¥æ­¤æ¥è°ƒæ•´æ¨¡å‹çš„å‚æ•°å’Œç»“æ„ï¼Œä½¿æ¨¡å‹ä¸ä»…èƒ½åœ¨è®­ç»ƒé›†ä¸Šè¡¨ç°è‰¯å¥½ï¼ŒåŒæ—¶ä¹Ÿèƒ½åœ¨æœªè§è¿‡çš„æ•°æ®ä¸Šæœ‰è‰¯å¥½çš„è¡¨ç°ã€‚éªŒè¯é›†çš„æ•°æ®é‡é€šå¸¸å°äºè®­ç»ƒé›†ï¼Œä½†å¤§äºæµ‹è¯•é›†ã€‚éªŒè¯é›†åœ¨æœºå™¨å­¦ä¹ ä¸­èµ·åˆ°äº†æ¡¥æ¢çš„ä½œç”¨ï¼Œå®ƒæ—¢ä¸å‚ä¸æ¨¡å‹çš„è®­ç»ƒï¼Œä¹Ÿä¸å‚ä¸æ¨¡å‹çš„æœ€ç»ˆè¯„ä¼°ï¼Œå®ƒçš„è§’è‰²æ˜¯åœ¨è®­ç»ƒå’Œæµ‹è¯•ä¹‹é—´ï¼Œç”¨æ¥ä¼˜åŒ–å’Œè°ƒæ•´æ¨¡å‹çš„ã€‚
- æµ‹è¯•é›†æ˜¯ç”¨æ¥åœ¨æ¨¡å‹æœ€ç»ˆç¡®å®šåï¼Œè¯„ä¼°æ¨¡å‹åœ¨æœªçŸ¥æ•°æ®ä¸Šçš„æ€§èƒ½ï¼Œä»¥ç¡®å®šæ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚æµ‹è¯•é›†çš„æ•°æ®æ˜¯æ¨¡å‹åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä»æœªè§è¿‡çš„ï¼Œé€šè¿‡æµ‹è¯•é›†ï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£åˆ°æ¨¡å‹åœ¨é¢å¯¹æœªçŸ¥æ•°æ®æ—¶çš„è¡¨ç°èƒ½åŠ›ï¼Œä»è€Œè¯„ä¼°æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚æµ‹è¯•é›†çš„æ•°æ®é‡é€šå¸¸å°äºè®­ç»ƒé›†å’ŒéªŒè¯é›†ï¼Œé€šè¿‡æµ‹è¯•é›†ï¼Œæˆ‘ä»¬å¯ä»¥çœŸå®åœ°äº†è§£åˆ°æ¨¡å‹çš„æ€§èƒ½å’Œèƒ½åŠ›ã€‚

å…³äºæ•°æ®é›†å„ä¸ªéƒ¨åˆ†çš„åˆ’åˆ†æ¯”ä¾‹å¹¶æ²¡æœ‰æ˜ç¡®çš„è§„å®šï¼Œä¸è¿‡å¯ä»¥å‚è€ƒä»¥ä¸‹3ä¸ªåŸåˆ™ï¼š

1. å¯¹äºå°è§„æ¨¡æ ·æœ¬é›†ï¼ˆå‡ ä¸‡é‡çº§ï¼‰ï¼Œå¸¸ç”¨çš„åˆ†é…æ¯”ä¾‹æ˜¯ 60% è®­ç»ƒé›†ã€20% éªŒè¯é›†ã€20% æµ‹è¯•é›†ã€‚
2. å¯¹äºå¤§è§„æ¨¡æ ·æœ¬é›†ï¼ˆç™¾ä¸‡çº§ä»¥ä¸Šï¼‰ï¼Œåªè¦éªŒè¯é›†å’Œæµ‹è¯•é›†çš„æ•°é‡è¶³å¤Ÿå³å¯ï¼Œä¾‹å¦‚æœ‰ 100w æ¡æ•°æ®ï¼Œé‚£ä¹ˆç•™ 1w éªŒè¯é›†ï¼Œ1w æµ‹è¯•é›†å³å¯ã€‚1000w çš„æ•°æ®ï¼ŒåŒæ ·ç•™ 1w éªŒè¯é›†å’Œ 1w æµ‹è¯•é›†ã€‚
3. è¶…å‚æ•°è¶Šå°‘ï¼Œæˆ–è€…è¶…å‚æ•°å¾ˆå®¹æ˜“è°ƒæ•´ï¼Œé‚£ä¹ˆå¯ä»¥å‡å°‘éªŒè¯é›†çš„æ¯”ä¾‹ï¼Œæ›´å¤šçš„åˆ†é…ç»™è®­ç»ƒé›†ã€‚

![Untitled1.png]

## æ•°æ®é›†å»å“ªå„¿æ‰¾

è·å–æ•°æ®é›†çš„æ–¹æ³•æœ‰å¤šç§ï¼Œå¯ä»¥ä»å¼€æ”¾æ•°æ®é›†å¹³å°å¦‚Kaggle, Google Dataset Searchç­‰è·å–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è‡ªå·±æ”¶é›†æ„å»ºã€‚æ­¤å¤–ï¼Œä¸€äº›å…¬å…±æœºæ„æˆ–ç ”ç©¶æœºæ„ä¹Ÿä¼šæä¾›ä¸€äº›ä¸“ä¸šé¢†åŸŸçš„æ•°æ®é›†ä¾›ç ”ç©¶è€…ä½¿ç”¨ã€‚æˆ‘ä»¬è¿™æ¬¡è¦è®­ç»ƒä¸€ä¸ªç®€å•çš„å›¾åƒåˆ†ç±»æ¨¡å‹ï¼Œ[Kaggle](http://www.kaggle.com/)ä¸Šçš„[Animals-10](https://www.kaggle.com/datasets/alessiocorrado99/animals10/data)æ˜¯ä¸€ä¸ªä¸é”™çš„æ•°æ®é›†ï¼ŒåŒ…å«äº†10ç§å¸¸è§åŠ¨ç‰©çš„åˆ†ç±»ï¼Œä¸€å…±28kå¼ å›¾ç‰‡ï¼Œè¿™ç‚¹å„¿å›¾ç‰‡åœ¨è‡ªå·±ç”µè„‘ä¸Šè·‘å®Œå…¨æ— å‹åŠ›ã€‚

![Untitled2]

## é¢„å¤„ç†æ•°æ®

åœ¨Create MLä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä¸»åŠ¨æä¾›è¿™è®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼ŒCreate MLå¯ä»¥æ ¹æ®æˆ‘ä»¬ä¸Šä¼ çš„è®­ç»ƒé›†è‡ªåŠ¨æŠ½å–éƒ¨åˆ†æ•°æ®ä½œä¸ºéªŒè¯é›†ã€‚åœ¨ä¸‹è½½å®ŒæˆåŸå§‹æ•°æ®é›†åï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±åˆ’åˆ†è®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œè¿™é‡Œé€šè¿‡chatGPTæ¥å¿«é€Ÿå®ç°ä¸€ä¸ªpythonè„šæœ¬å¯ä»¥æŒ‰æŒ‡å®šæ¯”ä¾‹å°†åŸå§‹æ•°æ®é›†åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ã€‚

```python
import os
import random
import shutil
import argparse

parser = argparse.ArgumentParser(description='Split training set into training and test sets.')
parser.add_argument('input_dir', type=str, help='Path to the input training set directory')
parser.add_argument('--test_ratio', type=float, default=0.2, help='Ratio of the test set (default: 0.2)')
args = parser.parse_args()

# è¾“å…¥å›¾ç‰‡è®­ç»ƒé›†ç›®å½•å’Œæµ‹è¯•é›†æ¯”ä¾‹
input_dir = args.input_dir
test_ratio = args.test_ratio

# è¾“å‡ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ç›®å½•
output_train_dir = os.path.join(os.path.dirname(input_dir), 'training_set')
output_test_dir = os.path.join(os.path.dirname(input_dir), 'test_set')

# åˆ›å»ºè¾“å‡ºç›®å½•
os.makedirs(output_train_dir, exist_ok=True)
os.makedirs(output_test_dir, exist_ok=True)

# éå†è¾“å…¥ç›®å½•ä¸­çš„å­ç›®å½•
for subdir in os.listdir(input_dir):
    subdir_path = os.path.join(input_dir, subdir)

    if not os.path.isdir(subdir_path):
        continue

    # è·å–å­ç›®å½•ä¸­çš„æ‰€æœ‰å›¾ç‰‡çš„è·¯å¾„
    image_paths = []
    for file in os.listdir(subdir_path):
        if file.endswith('.jpg') or file.endswith('.png') or file.endswith('.jpeg'):
            image_paths.append(os.path.join(subdir_path, file))

    # éšæœºæ‰“ä¹±å›¾ç‰‡è·¯å¾„
    random.shuffle(image_paths)

    # åˆ’åˆ†è®­ç»ƒé›†å’Œæµ‹è¯•é›†
    split_index = int(len(image_paths) * (1 - test_ratio))
    train_image_paths = image_paths[:split_index]
    test_image_paths = image_paths[split_index:]

    # å°†è®­ç»ƒé›†å’Œæµ‹è¯•é›†åˆ†åˆ«æ‹·è´åˆ°è¾“å‡ºç›®å½•
    for image_path in train_image_paths:
        dst_path = os.path.join(output_train_dir, subdir, os.path.basename(image_path))
        os.makedirs(os.path.dirname(dst_path), exist_ok=True)
        shutil.copyfile(image_path, dst_path)

    for image_path in test_image_paths:
        dst_path = os.path.join(output_test_dir, subdir, os.path.basename(image_path))
        os.makedirs(os.path.dirname(dst_path), exist_ok=True)
        shutil.copyfile(image_path, dst_path)
```

æ‰§è¡Œ *python3 predata.py raw-img --test_ratio 0.2* å‘½ä»¤ä¼šæŒ‰8æ¯”2ç”Ÿæˆè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œè‡³æ­¤æˆ‘ä»¬å®Œæˆäº†æ•°æ®çš„é¢„å¤„ç†ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ‰§è¡Œå‡ æ¬¡å‘½ä»¤äº§ç”Ÿä¸åŒçš„è®­ç»ƒæ•°æ®é‡å¤è®­ç»ƒæ¨¡å‹ï¼Œç›´åˆ°æ»¡æ„ä¸ºæ­¢ã€‚

# ä½¿ç”¨ Create ML

Create MLä½œä¸ºå¼€å‘è€…å·¥å…·è¢«é›†æˆåœ¨Xcodeå½“ä¸­ï¼Œå”¤èµ·è·¯å¾„å¦‚ä¸‹ã€‚

![Untitled3]

æ–°å»ºä¸€ä¸ªé¡¹ç›®ï¼ŒCreate MLé»˜è®¤æä¾›äº†ä¸åŒç±»å‹çš„æœºå™¨å­¦ä¹ ä»»åŠ¡ï¼ŒåŒ…æ‹¬å›¾åƒã€æ–‡å­—ã€è§†é¢‘ã€éŸ³é¢‘ç­‰å¤šç§æ¨¡æ¿ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©å›¾åƒåˆ†ç±»ã€‚

![Untitled4]

## å›¾åƒåˆ†ç±»

å›¾åƒåˆ†ç±»æ˜¯æœºå™¨å­¦ä¹ çš„ä¸€ä¸ªé‡è¦åº”ç”¨ï¼Œå®ƒçš„ç›®æ ‡æ˜¯å°†è¾“å…¥çš„å›¾åƒåˆ†é…åˆ°é¢„å®šä¹‰çš„ç±»åˆ«ä¹‹ä¸€ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åç§åŠ¨ç‰©çš„å›¾åƒæ¥è®­ç»ƒæ¨¡å‹ï¼Œè®©æ¨¡å‹å­¦ä¹ å¦‚ä½•åŒºåˆ†è¿™åç§åŠ¨ç‰©ã€‚è¿™æ ·ï¼Œå½“æˆ‘ä»¬å°†æ–°çš„åŠ¨ç‰©å›¾åƒè¾“å…¥åˆ°æ¨¡å‹ä¸­æ—¶ï¼Œæ¨¡å‹å°±å¯ä»¥é¢„æµ‹å‡ºè¿™æ˜¯å“ªç§åŠ¨ç‰©ã€‚

![Untitled5]

## Embedding

åœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œç‰¹å¾æŠ½å–æ˜¯ä¸€é¡¹å…³é”®çš„ä»»åŠ¡ã€‚ç‰¹å¾æŠ½å–æ˜¯å°†åŸå§‹æ•°æ®è½¬æ¢ä¸ºæœºå™¨å­¦ä¹ ç®—æ³•å¯ä»¥ç†è§£çš„æ ¼å¼çš„è¿‡ç¨‹ã€‚å¯¹äºå›¾åƒæ•°æ®ï¼Œç‰¹å¾å¯èƒ½åŒ…æ‹¬é¢œè‰²ã€å½¢çŠ¶ã€çº¹ç†ç­‰ã€‚è¿™äº›ç‰¹å¾è¢«ç”¨æ¥è®­ç»ƒæœºå™¨å­¦ä¹ æ¨¡å‹ï¼Œä½¿æ¨¡å‹èƒ½å¤Ÿä»å›¾åƒä¸­è¯†åˆ«å‡ºæœ‰ç”¨çš„æ¨¡å¼ã€‚ä»¥å¾€æƒ³è¦è®©è®¡ç®—æœºè¡¨ç¤ºä¸€å¼ å›¾ç‰‡å¯ä»¥ä½¿ç”¨åƒç´ è¡¨ç¤ºæ³•ï¼Œå¦‚æœæ¯ä¸ªåƒç´ å‡ç”±RGBä¸‰ä¸ªè‰²å€¼è¡¨ç¤ºçš„è¯ï¼Œä¸€å¼ å›¾å°±éœ€è¦ n x n x 3 ä¸ªåƒç´ æ¥è¡¨ç¤ºï¼Œå¦‚æœæŒ‰ç…§åƒç´ è®¡ç®—çš„æ–¹å¼å»ç†è§£ä¸€å¼ å›¾ï¼Œè¿™ä¸ªè®¡ç®—å¤æ‚åº¦å°†æ˜¯å·¨å¤§çš„ã€‚

![Untitled6]

Embedding æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç‰¹å¾æŠ½å–æ–¹æ³•ï¼Œå®ƒå°†é«˜ç»´çš„è¾“å…¥æ•°æ®ï¼ˆå¦‚å›¾åƒæˆ–æ–‡æœ¬ï¼‰æ˜ å°„åˆ°ä¸€ä¸ªä½ç»´çš„è¿ç»­å‘é‡ç©ºé—´ï¼Œè¿™ä¸ªè¿ç»­å‘é‡ç©ºé—´ä¸­çš„ç‚¹å¯ä»¥è¡¨ç¤ºåŸå§‹è¾“å…¥æ•°æ®çš„æŸç§è¯­ä¹‰ä¿¡æ¯ã€‚åœ¨å›¾åƒåˆ†ç±»ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é¢„è®­ç»ƒçš„ç¥ç»ç½‘ç»œæ¨¡å‹ï¼ˆå¦‚ResNetã€Inceptionç­‰ï¼‰ä½œä¸ºåµŒå…¥æ¨¡å‹ï¼Œå°†åŸå§‹çš„å›¾åƒæ•°æ®è½¬æ¢æˆä½ç»´çš„ç‰¹å¾å‘é‡ï¼Œç„¶åå†åŸºäºè¿™äº›ç‰¹å¾å‘é‡æ¥è®­ç»ƒæˆ‘ä»¬çš„åˆ†ç±»æ¨¡å‹ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†å›¾ç‰‡ä»åƒç´ ç©ºé—´æ˜ å°„åˆ°äº†ä¸€ä¸ªæ›´å°çš„ã€æ›´æ˜“å¤„ç†çš„ç©ºé—´ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ›´å°‘çš„æ•°æ®æ¥è¡¨ç¤ºä¸€å¼ å›¾ç‰‡ï¼ŒåŒæ—¶ä¿ç•™äº†å›¾ç‰‡ä¸­çš„å…³é”®ä¿¡æ¯ã€‚ä¸‹é¢å±•ç¤ºäº†ä¸€æ®µä½¿ç”¨tensorflowç”Ÿæˆä¸€å¼ å›¾ç‰‡embeddingçš„ä»£ç ï¼Œå…¶ç”Ÿæˆç»“æœæ˜¯ä¸€ä¸ª1x2048çš„å‘é‡ã€‚

![Untitled7]

## Embeddingçš„ç›¸ä¼¼åº¦

é€šè¿‡Embeddingæˆ‘ä»¬å°†2ä¸ªå›¾åƒçš„ç›¸å…³æ€§é—®é¢˜è½¬åŒ–ä¸ºäº†åˆ¤æ–­2ä¸ªvectorç›¸ä¼¼åº¦é—®é¢˜ã€‚é€šè¿‡è®¡ç®—2ä¸ªvectorçš„ä½™å¼¦è·ç¦»(1 - Cosine Similarity)å°±æ˜¯å…¶ä¸­å¸¸ç”¨çš„ä¸€ç§æ–¹æ³•ã€‚

![Untitled8]

å…¶ä»–è®¡ç®—æ–¹å¼è¿˜æœ‰æ¬§å¼è·ç¦»ã€æ›¼å“ˆé¡¿è·ç¦»ã€é©¬æ°è·ç¦»ã€KLæ•£åº¦ã€å¸ƒæœ—è·ç¦»åæ–¹å·®ç­‰ã€‚

## å›¾åƒåˆ†ç±»ç®—æ³•

è¿™é‡Œç®€å•åˆ—å‡ºä¸€äº›å¸¸è§çš„å›¾åƒåˆ†ç±»ç®—æ³•ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥æ·±å…¥ç ”ç©¶ï¼ˆå¤ªå¤æ‚å°±ä¸å¤šè¯´äº†**ğŸ¤¦â€â™‚ï¸**ï¼‰ï¼ŒAppleåœ¨è¿™é‡Œä¹Ÿæ²¡æ˜ç¡®ç»™å‡ºè‡ªå·±ç”¨çš„æ˜¯å“ªä¸ªæ¨¡å‹ï¼Œå¤§æ¦‚ç‡æ˜¯CNNæˆ–è€…ResNetã€‚

- æ”¯æŒå‘é‡æœºï¼ˆSupport Vector Machinesï¼ŒSVMï¼‰ï¼šSVMæ˜¯ä¸€ç§ç»å…¸çš„ç›‘ç£å­¦ä¹ ç®—æ³•ï¼Œåœ¨å›¾åƒåˆ†ç±»ä¸­ä¹Ÿæœ‰å¹¿æ³›åº”ç”¨ã€‚å®ƒé€šè¿‡åœ¨ç‰¹å¾ç©ºé—´ä¸­æ„å»ºä¸€ä¸ªæœ€ä¼˜è¶…å¹³é¢æ¥å®ç°åˆ†ç±»ã€‚
- å†³ç­–æ ‘ï¼ˆDecision Treesï¼‰ï¼šå†³ç­–æ ‘æ˜¯ä¸€ç§åŸºäºæ ‘ç»“æ„çš„åˆ†ç±»ç®—æ³•ï¼Œå¯ä»¥æ ¹æ®å›¾åƒçš„ç‰¹å¾è¿›è¡Œåˆ†å‰²å’Œåˆ†ç±»ã€‚
- éšæœºæ£®æ—ï¼ˆRandom Forestï¼‰ï¼šéšæœºæ£®æ—æ˜¯ä¸€ç§é›†æˆå­¦ä¹ æ–¹æ³•ï¼Œç”±å¤šä¸ªå†³ç­–æ ‘ç»„æˆã€‚å®ƒé€šè¿‡æŠ•ç¥¨æˆ–å¹³å‡å¤šä¸ªå†³ç­–æ ‘çš„é¢„æµ‹ç»“æœæ¥è¿›è¡Œåˆ†ç±»ã€‚
- Kæœ€è¿‘é‚»ç®—æ³•ï¼ˆK-Nearest Neighborsï¼ŒKNNï¼‰ï¼šKNNæ˜¯ä¸€ç§ç®€å•è€Œç›´è§‚çš„åˆ†ç±»ç®—æ³•ã€‚å®ƒæ ¹æ®ç¦»å¾…åˆ†ç±»æ ·æœ¬æœ€è¿‘çš„Kä¸ªé‚»å±…çš„ç±»åˆ«æ¥ç¡®å®šè¯¥æ ·æœ¬çš„ç±»åˆ«ã€‚
- å¤šå±‚æ„ŸçŸ¥æœºï¼ˆMultilayer Perceptronï¼ŒMLPï¼‰ï¼šMLPæ˜¯ä¸€ç§å‰é¦ˆç¥ç»ç½‘ç»œï¼Œå¸¸ç”¨äºå›¾åƒåˆ†ç±»ã€‚å®ƒç”±å¤šä¸ªå…¨è¿æ¥å±‚ç»„æˆï¼Œå¯ä»¥å­¦ä¹ å’Œæå–å›¾åƒçš„ç‰¹å¾ã€‚
- å·ç§¯ç¥ç»ç½‘ç»œï¼ˆConvolutional Neural Networksï¼ŒCNNï¼‰ï¼šCNNæ˜¯æœ€å¸¸ç”¨çš„å›¾åƒåˆ†ç±»ç®—æ³•ä¹‹ä¸€ã€‚å®ƒé€šè¿‡ä½¿ç”¨å·ç§¯å±‚ã€æ± åŒ–å±‚å’Œå…¨è¿æ¥å±‚æ¥è‡ªåŠ¨å­¦ä¹ å›¾åƒä¸­çš„ç‰¹å¾å¹¶è¿›è¡Œåˆ†ç±»ã€‚
- æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼ˆå¦‚ResNetã€Inceptionã€VGGç­‰ï¼‰ï¼šè¿™äº›æ˜¯åŸºäºæ·±åº¦ç¥ç»ç½‘ç»œçš„å…ˆè¿›æ¨¡å‹ï¼Œå…·æœ‰æ›´å¼ºå¤§çš„å­¦ä¹ èƒ½åŠ›å’Œæ›´å¥½çš„æ€§èƒ½ã€‚è¿™äº›æ¨¡å‹é€šå¸¸åœ¨å¤§è§„æ¨¡æ•°æ®é›†ä¸Šè¿›è¡Œé¢„è®­ç»ƒï¼Œå¹¶åœ¨å›¾åƒåˆ†ç±»ä»»åŠ¡ä¸­è¿›è¡Œå¾®è°ƒã€‚

## å¼€å§‹è®­ç»ƒ

å›åˆ°Create MLï¼Œæˆ‘ä»¬å°†é¢„å¤„ç†å¥½çš„è®­ç»ƒé›†å’Œæµ‹è¯•é›†åˆ†åˆ«æ‹–åˆ°å¯¹åº”çš„ä½ç½®ï¼ŒCreate MLä¾¿ä¼šè‡ªåŠ¨è¯†åˆ«æ•°æ®é›†çš„å†…å®¹ï¼ŒåŒæ—¶è‡ªåŠ¨åˆ’åˆ†å‡ºä¸€éƒ¨åˆ†æ•°æ®ä½œä¸ºéªŒè¯é›†ã€‚

![Untitled9]

Create MLä¸ºæˆ‘ä»¬æä¾›äº†ä¸€äº›å¯é€‰çš„è®­ç»ƒå‚æ•°ï¼Œ2ç§feature extractorï¼ˆç‰¹å¾æŠ½å–å™¨ï¼‰å¯é€‰ï¼ŒV2ç›¸æ¯”V1æŠ½å–çš„æ›´å¿«éœ€è¦çš„ç©ºé—´æ›´å¥½ï¼Œä½†æ˜¯ç³»ç»Ÿå…¼å®¹æ€§ä¸å¦‚V1ã€‚è¿­ä»£æ¬¡æ•°é»˜è®¤ä¸º25æ¬¡ï¼Œaugmetationsï¼ˆå¢å¼ºï¼‰é€‰é¡¹é‡Œæˆ‘ä»¬å¯ä»¥å¯¹è®­ç»ƒæ•°æ®æ·»åŠ ä¸åŒå˜ä½“æ¥å¼ºåŒ–è®­ç»ƒçš„æ•ˆæœï¼Œæ¯”å¦‚åŠ å…¥å™ªå£°ã€ç¿»è½¬å’Œè£åˆ‡ç­‰ã€‚

![Untitled10]

è‡³æ­¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹è®­ç»ƒæ¨¡å‹äº†ï¼Œç‰¹å¾æŠ½å–æ˜¯æ ¸å¿ƒè¿‡ç¨‹ï¼Œæ•´ä¸ªè¿‡ç¨‹æŒç»­äº†5~10åˆ†é’Ÿï¼Œéšåå°±æ˜¯å®Œæˆ25æ¬¡è¿­ä»£è®¡ç®—ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬çš„æ¨¡å‹é€æ¸æ”¶æ•›ï¼Œcreate MLæä¾›äº†å®æ—¶çš„å¯è§†åŒ–è®­ç»ƒæ›²çº¿ã€‚è®­ç»ƒç»“æŸåå½“å³ç»™å‡ºåœ¨è®­ç»ƒé›†å’ŒéªŒè¯é›†ä¸Šçš„å‡†ç¡®ç‡ï¼ŒåŒæ—¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•é›†ï¼Œå¹¶ç»™å‡ºæœ€ç»ˆçš„æµ‹è¯•å‡†ç¡®ç‡ã€‚

![Untitled.jpeg]

![Untitled1.jpeg]

åœ¨Evaluationé¡µé¢ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´è§‚åœ°çœ‹åˆ°è®­ç»ƒç»“æœçš„å„é¡¹è¯¦ç»†æŒ‡æ ‡ï¼ŒåŒæ—¶å®ƒä¼šç»™å‡ºè¯†åˆ«é”™è¯¯æœ€å¤šçš„ä¸€äº›å›¾ç‰‡ï¼Œæ–¹ä¾¿æˆ‘ä»¬é’ˆå¯¹æ€§åœ°å¯¹è¿™äº›å›¾ç‰‡å†æ¬¡è®­ç»ƒã€‚

![Untitled11]

![Untitled12]

## è¯„ä»·æŒ‡æ ‡

åœ¨è®­ç»ƒç»“æœä¸­æœ‰4é¡¹é‡è¦çš„è¯„ä¼°æŒ‡æ ‡ï¼šaccuracyã€precisionã€recallå’ŒF1 Scoreï¼Œä¸‹é¢ç®€å•ä»‹ç»ä¸‹è¿™äº›æŒ‡æ ‡çš„å«ä¹‰ä»¥åŠå¯¹åº”çš„è®¡ç®—æ–¹å¼ã€‚

### æ··æ·†çŸ©é˜µï¼ˆConfusion Matrixï¼‰

ä¸€èˆ¬é€šè¿‡æœºå™¨å­¦ä¹ ä¼šäº§ç”Ÿå››ç±»ç»“æœï¼šTNã€TPã€FNå’ŒFPã€‚çœŸæ­£ä¾‹å’ŒçœŸåä¾‹æ˜¯è¢«æ­£ç¡®é¢„æµ‹çš„æ•°æ®ï¼Œå‡æ­£ä¾‹å’Œå‡åä¾‹æ˜¯è¢«é”™è¯¯é¢„æµ‹çš„æ•°æ®ã€‚

- TPï¼ˆTrue Positiveï¼‰ï¼šè¢«æ­£ç¡®é¢„æµ‹çš„æ­£ä¾‹ã€‚å³è¯¥æ•°æ®çš„çœŸå®å€¼ä¸ºæ­£ä¾‹ï¼Œé¢„æµ‹å€¼ä¹Ÿä¸ºæ­£ä¾‹çš„æƒ…å†µï¼›
- TNï¼ˆTrue Negativeï¼‰ï¼šè¢«æ­£ç¡®é¢„æµ‹çš„åä¾‹ã€‚å³è¯¥æ•°æ®çš„çœŸå®å€¼ä¸ºåä¾‹ï¼Œé¢„æµ‹å€¼ä¹Ÿä¸ºåä¾‹çš„æƒ…å†µ;
- FPï¼ˆFalse Positiveï¼‰ï¼šè¢«é”™è¯¯é¢„æµ‹çš„æ­£ä¾‹ã€‚å³è¯¥æ•°æ®çš„çœŸå®å€¼ä¸ºåä¾‹ï¼Œä½†è¢«é”™è¯¯é¢„æµ‹æˆäº†æ­£ä¾‹çš„æƒ…å†µï¼›
- FNï¼ˆFalse Negativeï¼‰ï¼šè¢«é”™è¯¯é¢„æµ‹çš„åä¾‹ã€‚å³è¯¥æ•°æ®çš„çœŸå®å€¼ä¸ºæ­£ä¾‹ï¼Œä½†è¢«é”™è¯¯é¢„æµ‹æˆäº†åä¾‹çš„æƒ…å†µã€‚

![Untitled13]

### å‡†ç¡®ç‡ï¼ˆAccuracyï¼‰

åˆ†ç±»æ­£ç¡®çš„æ ·æœ¬å æ€»æ ·æœ¬ä¸ªæ•°çš„æ¯”ä¾‹

![Untitled17]

Accuracyæ˜¯è¡¡é‡åˆ†ç±»æ¨¡å‹çš„æœ€ç›´ç™½çš„æŒ‡æ ‡ï¼Œä½†ç¼ºé™·ä¹Ÿæ˜¯æ˜æ˜¾çš„ã€‚å‡è®¾æœ‰100ä¸ªæ ·æœ¬ï¼Œå…¶ä¸­æœ‰99ä¸ªéƒ½æ˜¯æ­£æ ·æœ¬ï¼Œåˆ™åˆ†ç±»å™¨åªéœ€è¦ä¸€ç›´é¢„æµ‹ä¸ºæ­£ä¾‹ï¼Œå°±å¯ä»¥å¾—åˆ°99%çš„å‡†ç¡®ç‡ï¼Œå®é™…ä¸Šè¿™ä¸ªåˆ†ç±»å™¨æ€§èƒ½æ˜¯å¾ˆä½ä¸‹çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä¸åŒç±»åˆ«çš„æ ·æœ¬æ‰€å çš„æ¯”ä¾‹ä¸¥é‡ä¸å¹³è¡¡æ—¶ï¼Œå æ¯”å¤§çš„ç±»åˆ«ä¼šæ˜¯å½±å“å‡†ç¡®ç‡çš„æœ€ä¸»è¦çš„å› ç´ ã€‚æ‰€ä»¥ï¼Œåªæœ‰å½“æ•°æ®é›†å„ä¸ªç±»åˆ«çš„æ ·æœ¬æ¯”ä¾‹æ¯”è¾ƒå‡è¡¡æ—¶ï¼ŒAccuracyè¿™ä¸ªæŒ‡æ ‡æ‰æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çš„è¡¡é‡æ ‡å‡†ã€‚å› æ­¤ï¼Œå¿…é¡»å‚è€ƒå…¶ä»–æŒ‡æ ‡æ‰èƒ½å®Œæ•´è¯„ä¼°æ¨¡å‹çš„æ€§èƒ½ã€‚

### ç²¾ç¡®ç‡ï¼ˆPrecisionï¼‰

é¢„æµ‹ç»“æœä¸­çœŸæ­£ä¾‹å æ‰€æœ‰é¢„æµ‹ä¸ºæ­£ä¾‹çš„æ¯”ä¾‹ï¼ˆæµ‹é‡æ‰¾çš„å¯¹ï¼‰

![Untitled18]

ä½¿ç”¨åœºæ™¯ï¼šå½“åä¾‹è¢«é”™è¯¯é¢„æµ‹æˆæ­£ä¾‹ï¼ˆFPï¼‰çš„ä»£ä»·å¾ˆé«˜æ—¶ï¼Œé€‚åˆç”¨ç²¾ç¡®ç‡ã€‚æ ¹æ®å…¬å¼å¯çŸ¥ï¼Œç²¾ç¡®ç‡è¶Šé«˜ï¼ŒFPè¶Šå°ã€‚æ¯”å¦‚åœ¨åƒåœ¾åœ¨åƒåœ¾é‚®ä»¶æ£€æµ‹ä¸­ï¼Œå‡æ­£ä¾‹æ„å‘³ç€éåƒåœ¾é‚®ä»¶ï¼ˆå®é™…ä¸ºè´Ÿï¼‰è¢«é”™è¯¯çš„é¢„æµ‹ä¸ºåƒåœ¾é‚®ä»¶ï¼ˆé¢„æµ‹ä¸ºæ­£ï¼‰ã€‚å¦‚æœä¸€ä¸ªåƒåœ¾é‚®ä»¶ç›‘æµ‹ç³»ç»Ÿçš„æŸ¥å‡†ç‡ä¸é«˜å¯¼è‡´å¾ˆå¤šéåƒåœ¾é‚®ä»¶è¢«å½’åˆ°åƒåœ¾é‚®ç®±é‡Œå»ï¼Œé‚£ä¹ˆé‚®ç®±ç”¨æˆ·å¯èƒ½ä¼šä¸¢å¤±æˆ–è€…æ¼çœ‹ä¸€äº›å¾ˆé‡è¦çš„é‚®ä»¶ã€‚

### å¬å›ç‡ï¼ˆRecallï¼‰

æ ·æœ¬ä¸­çš„æ­£ä¾‹æœ‰å¤šå°‘è¢«æ­£ç¡®é¢„æµ‹ï¼ˆæµ‹é‡æ‰¾çš„å…¨ï¼‰

![Untitled19]

ä½¿ç”¨åœºæ™¯ï¼šå½“æ­£ä¾‹è¢«é”™è¯¯çš„é¢„æµ‹ä¸ºåä¾‹ï¼ˆFNï¼‰äº§ç”Ÿçš„ä»£ä»·å¾ˆé«˜æ—¶ï¼Œé€‚åˆç”¨å¬å›ç‡ã€‚æ ¹æ®å…¬å¼å¯çŸ¥ï¼Œå¬å›ç‡è¶Šé«˜ï¼ŒFNè¶Šå°ã€‚æ¯”å¦‚è¯´åœ¨é“¶è¡Œçš„æ¬ºè¯ˆæ£€æµ‹æˆ–åŒ»é™¢çš„ç—…æ‚£è€…æ£€æµ‹ä¸­ï¼Œå¦‚æœå°†æ¬ºè¯ˆæ€§äº¤æ˜“ï¼ˆå®é™…ä¸ºæ­£ï¼‰é¢„æµ‹ä¸ºéæ¬ºè¯ˆæ€§äº¤æ˜“ï¼ˆé¢„æµ‹ä¸ºè´Ÿï¼‰ï¼Œåˆ™å¯èƒ½ä¼šç»™é“¶è¡Œå¸¦æ¥éå¸¸ä¸¥é‡çš„æŸå¤±ã€‚å†æ¯”å¦‚ä»¥æœ€è¿‘çš„æ–°å† ç–«æƒ…ä¸ºä¾‹ï¼Œå¦‚æœä¸€ä¸ªæ‚£ç—…è€…ï¼ˆå®é™…ä¸ºæ­£ï¼‰ç»è¿‡è¯•å‰‚æ£€æµ‹è¢«é¢„æµ‹ä¸ºæ²¡æœ‰æ‚£ç—…ï¼ˆé¢„æµ‹ä¸ºè´Ÿï¼‰ï¼Œè¿™æ ·çš„å‡åä¾‹æˆ–è€…è¯´å‡é˜´æ€§äº§ç”Ÿçš„é£é™©å°±éå¸¸å¤§ã€‚

### F1 Score

F1 scoreæ˜¯ç²¾ç¡®ç‡å’Œå¬å›ç‡çš„ä¸€ä¸ªåŠ æƒå¹³å‡

![Untitled20]

Precisionä½“ç°äº†æ¨¡å‹å¯¹è´Ÿæ ·æœ¬çš„åŒºåˆ†èƒ½åŠ›ï¼ŒPrecisionè¶Šé«˜ï¼Œæ¨¡å‹å¯¹è´Ÿæ ·æœ¬çš„åŒºåˆ†èƒ½åŠ›è¶Šå¼ºï¼›Recallä½“ç°äº†æ¨¡å‹å¯¹æ­£æ ·æœ¬çš„è¯†åˆ«èƒ½åŠ›ï¼ŒRecallè¶Šé«˜ï¼Œæ¨¡å‹å¯¹æ­£æ ·æœ¬çš„è¯†åˆ«èƒ½åŠ›è¶Šå¼ºã€‚F1 scoreæ˜¯ä¸¤è€…çš„ç»¼åˆï¼ŒF1 scoreè¶Šé«˜ï¼Œè¯´æ˜æ¨¡å‹è¶Šç¨³å¥ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯é€šè¿‡ä¸æ–­è°ƒæ•´è®­ç»ƒé›†ä»¥åŠå„ç§å‚æ•°æ¥ä½¿å¾—æœ€ç»ˆè®­ç»ƒå®Œæˆåçš„æ¨¡å‹å¯ä»¥åœ¨å„é¡¹æŒ‡æ ‡ä¸­è·å¾—æ›´é«˜å¾—åˆ†ã€‚

![Untitled14]

åœ¨è°ƒæ•´äº†è®­ç»ƒé›†å’Œå‚æ•°åï¼Œç¬¬äºŒæ¬¡è®­ç»ƒçš„æ•ˆæœç›¸è¾ƒç¬¬ä¸€æ¬¡æœ‰äº†æ˜¾è‘—æå‡ã€‚

## å°†æ¨¡å‹åº”ç”¨åˆ°App

åœ¨Outputé€‰é¡¹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä¸‹è½½æ¨¡å‹æˆ–è€…ç›´æ¥åœ¨Xcodeä¸­æ‰“å¼€ï¼Œæ¨¡å‹çš„æ ¼å¼æ˜¯.mlmodelï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬è¿™ä¸ªå°æ¨¡å‹åªæœ‰56kbã€‚

![Untitled15]

ç›´æ¥å°†æ¨¡å‹æ‹–å…¥ä½ çš„Xcodeé¡¹ç›®å°±å¯ä»¥è‡ªåŠ¨å¯¼å…¥äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯åœ¨ä»£ç å±‚é€šè¿‡è°ƒç”¨Visionæ¡†æ¶çš„APIæ¥å£å®ç°å¯¹ä¸€å¼ å›¾ç‰‡çš„è¯†åˆ«ã€‚

### åˆ›å»ºVNCoreMLModel

Xcodeç›´æ¥å°†æˆ‘ä»¬çš„æ¨¡å‹æ˜ å°„æˆäº†å¯¹åº”çš„Swiftç±»ï¼šMyImageClassifierï¼Œé€šè¿‡é€å±‚è§£åŒ…æˆ‘ä»¬æœ€ç»ˆæ‹¿åˆ°ä¸€ä¸ªVNCoreMLModel

```swift
static func createImageClassifier() -> VNCoreMLModel {
        // Use a default model configuration.
        let defaultConfig = MLModelConfiguration()

        // Create an instance of the image classifier's wrapper class.
        let imageClassifierWrapper = try? MyImageClassifier(configuration: defaultConfig)

        guard let imageClassifier = imageClassifierWrapper else {
            fatalError("App failed to create an image classifier model instance.")
        }

        // Get the underlying model instance.
        let imageClassifierModel = imageClassifier.model

        // Create a Vision instance using the image classifier's model instance.
        guard let imageClassifierVisionModel = try? VNCoreMLModel(for: imageClassifierModel) else {
            fatalError("App failed to create a `VNCoreMLModel` instance.")
        }

        return imageClassifierVisionModel
    }
```

### åˆ›å»ºVNCoreMLRequest

æ¯ä¸€æ¬¡è°ƒç”¨Core MLå¯¹å›¾ç‰‡è¿›è¡Œè¯†åˆ«éƒ½æ˜¯ä¸€æ¬¡VNCoreMLRequestï¼Œç±»ä¼¼ç½‘ç»œè¯·æ±‚ã€‚

```swift
 private func createImageClassificationRequest() -> VNImageBasedRequest {
        // Create an image classification request with an image classifier model.

        let imageClassificationRequest = VNCoreMLRequest(model: ImagePredictor.imageClassifier,
                                                         completionHandler: visionRequestHandler)

        imageClassificationRequest.imageCropAndScaleOption = .centerCrop
        return imageClassificationRequest
    }
```

### æ‰§è¡Œå›¾åƒåˆ†ç±»è¯·æ±‚

```swift
func makePredictions(for photo: UIImage, completionHandler: @escaping ImagePredictionHandler) throws {
        let orientation = CGImagePropertyOrientation(photo.imageOrientation)

        guard let photoImage = photo.cgImage else {
            fatalError("Photo doesn't have underlying CGImage.")
        }

        let imageClassificationRequest = createImageClassificationRequest()
        predictionHandlers[imageClassificationRequest] = completionHandler

        let handler = VNImageRequestHandler(cgImage: photoImage, orientation: orientation)
        let requests: [VNRequest] = [imageClassificationRequest]

        // Start the image classification request.
        try handler.perform(requests)
   
```

### è§£æå®Œæˆåçš„å›è°ƒ

```swift
private func visionRequestHandler(_ request: VNRequest, error: Error?) {
        // Remove the caller's handler from the dictionary and keep a reference to it.
        guard let predictionHandler = predictionHandlers.removeValue(forKey: request) else {
            fatalError("Every request must have a prediction handler.")
        }

        // Start with a `nil` value in case there's a problem.
        var predictions: [Prediction]? = nil

        // Call the client's completion handler after the method returns.
        defer {
            // Send the predictions back to the client.
            predictionHandler(predictions)
        }

        // Check for an error first.
        if let error = error {
            print("Vision image classification error...\n\n\(error.localizedDescription)")
            return
        }

        // Check that the results aren't `nil`.
        if request.results == nil {
            print("Vision request had no results.")
            return
        }

        // Cast the request's results as an `VNClassificationObservation` array.
        guard let observations = request.results as? [VNClassificationObservation] else {
            // Image classifiers, like MobileNet, only produce classification observations.
            // However, other Core ML model types can produce other observations.
            // For example, a style transfer model produces `VNPixelBufferObservation` instances.
            print("VNRequest produced the wrong result type: \(type(of: request.results)).")
            return
        }

        // Create a prediction array from the observations.
        predictions = observations.map { observation in
            // Convert each observation into an `ImagePredictor.Prediction` instance.
            Prediction(classification: observation.identifier,
                       confidencePercentage: observation.confidencePercentageString)
        }
    }
```

### è¿è¡Œæ•ˆæœ

åˆ†åˆ«ç”¨ğŸˆã€ğŸ¦‹ä»¥åŠä¸€ä¸ªğŸˆæ‰‹åŠè¿›è¡Œæµ‹è¯•ï¼Œéƒ½å¯ä»¥ç»™å‡ºç›¸å¯¹å‡†ç¡®åº¦çš„è¯†åˆ«ç»“æœã€‚

![Untitled16]

## å†™åœ¨ç»“å°¾

é™¤äº†Create MLæä¾›çš„è‡ªå¸¦æ¨¡å‹ï¼ŒAppleå®˜æ–¹è¿˜æä¾›äº†ä¸€ç³»åˆ—çƒ­é—¨çš„é¢„è®­ç»ƒæ¨¡å‹ï¼Œå…¨éƒ½æ˜¯Core MLæ ¼å¼çš„ï¼Œåœ¨[https://developer.apple.com/machine-learning/models/](https://developer.apple.com/machine-learning/models/)è¿™ä¸ªåœ°å€å¯ä»¥ç›´æ¥ä¸‹è½½ä½¿ç”¨ã€‚Create MLå’ŒCore MLçš„å‡ºç°æå¤§é™ä½äº†å¼€å‘è€…å…¥é—¨æœºå™¨å­¦ä¹ çš„é—¨æ§›ï¼Œç›¸ä¿¡é€šè¿‡ç»“åˆè‡ªèº«çš„ä¸šåŠ¡åœºæ™¯å’Œæ•°æ®åï¼Œç«¯AIå°†ä¼šæœ‰æ›´å¤šæ–°çš„ç©æ³•å’Œæœºä¼šã€‚

# References

[Create ML](https://developer.apple.com/documentation/CreateML)

[Classifying Images with Vision and Core ML](https://developer.apple.com/documentation/vision/classifying_images_with_vision_and_core_ml)

[Vision](https://developer.apple.com/documentation/vision/)

[ä¸€æ–‡çœ‹æ‡‚ AI æ•°æ®é›†ï¼šè®­ç»ƒé›†ã€éªŒè¯é›†ã€æµ‹è¯•é›†ï¼ˆé™„ï¼šåˆ†å‰²æ–¹æ³•+äº¤å‰éªŒè¯ï¼‰](https://easyaitech.medium.com/ä¸€æ–‡çœ‹æ‡‚-ai-æ•°æ®é›†-è®­ç»ƒé›†-éªŒè¯é›†-æµ‹è¯•é›†-é™„-åˆ†å‰²æ–¹æ³•-äº¤å‰éªŒè¯-9b3afd37fd58)

[å›¾åƒåˆ†ç±»æ–¹å‘ä¼˜è´¨å¼€æºæ•°æ®é›†æ±‡æ€»ï¼ˆé™„ä¸‹è½½é“¾æ¥ï¼‰](https://zhuanlan.zhihu.com/p/556588185)

[å›¾åƒåˆ†ç±»ç®—æ³•æœ‰å“ªäº›å¸¸ç”¨çš„ï¼Ÿ](https://zhuanlan.zhihu.com/p/639588895)

[Recommending Similar Images using Image Embedding](https://www.analyticsvidhya.com/blog/2022/07/recommending-similar-images-using-image-embedding/)

[è®¡ç®—embeddingç›¸ä¼¼åº¦çš„å‡ ç§æ–¹å¼](https://zhuanlan.zhihu.com/p/503996229)

[embeddingçš„åŸç†åŠå®è·µ](https://qiankunli.github.io/2022/03/02/embedding.html)

[æœºå™¨å­¦ä¹ -ç†è§£Accuracyï¼ŒPrecisionï¼ŒRecall, F1 scoreä»¥åŠsklearnå®ç°](https://zhuanlan.zhihu.com/p/405658103)

[å¬å›ç‡ï¼ˆrecallï¼‰å’Œç²¾åº¦ï¼ˆprecisionï¼‰ç²¾åº¦å’Œå¬å›ç‡-CSDNåšå®¢](https://blog.csdn.net/W1995S/article/details/114988637)